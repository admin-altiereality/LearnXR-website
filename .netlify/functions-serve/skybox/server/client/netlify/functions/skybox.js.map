{
  "version": 3,
  "sources": ["../../../../../../Users/gaurav/Desktop/Latest in3d/in3devoneuralwebsite/server/client/netlify/functions/skybox.js"],
  "sourceRoot": "/var/folders/kn/cg56x0815_n1rvxzlm8s4wkm0000gn/T/tmp-42075-Mb65WHQxbyEM",
  "sourcesContent": ["const { BlockadeLabsSdk } = require('@blockadelabs/sdk');\n\nexports.handler = async (event, context) => {\n  // Add comprehensive logging\n  console.log('=== SKYBOX FUNCTION CALLED ===');\n  console.log('Event path:', event.path);\n  console.log('Event httpMethod:', event.httpMethod);\n  console.log('Event headers:', event.headers);\n  console.log('Event queryStringParameters:', event.queryStringParameters);\n  console.log('Event body:', event.body);\n  console.log('Context:', context);\n  \n  // Enable CORS\n  const headers = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Headers': 'Content-Type, Authorization, X-Requested-With, X-API-Key',\n    'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\n    'Access-Control-Allow-Credentials': 'true'\n  };\n\n  // Handle preflight requests\n  if (event.httpMethod === 'OPTIONS') {\n    return {\n      statusCode: 200,\n      headers,\n      body: ''\n    };\n  }\n\n  try {\n    // Get BlockadeLabs API key from environment\n    const apiKey = process.env.BLOCKADELABS_API_KEY || process.env.API_KEY;\n    \n    if (!apiKey) {\n      console.error('No BlockadeLabs API key configured');\n      return {\n        statusCode: 500,\n        headers,\n        body: JSON.stringify({\n          error: 'API key not configured',\n          message: 'BLOCKADELABS_API_KEY or API_KEY environment variable is not set'\n        })\n      };\n    }\n\n    // Initialize BlockadeLabs SDK\n    const sdk = new BlockadeLabsSdk({ api_key: apiKey });\n\n    // Handle different endpoints\n    if (event.path.includes('/styles') || event.path.includes('/getSkyboxStyles')) {\n      console.log('Handling styles request');\n      return await handleGetStyles(headers, sdk);\n    } else if (event.path.includes('/generate')) {\n      console.log('Handling generation request');\n      return await handleGenerate(headers, sdk, event);\n    } else if (event.path.includes('/status/')) {\n      console.log('Handling status request');\n      return await handleGetStatus(headers, sdk, event);\n    } else if (event.path.includes('/test')) {\n      console.log('Handling test request');\n      return {\n        statusCode: 200,\n        headers,\n        body: JSON.stringify({\n          success: true,\n          message: 'Skybox function is working!',\n          path: event.path,\n          method: event.httpMethod,\n          timestamp: new Date().toISOString()\n        })\n      };\n    } else {\n      console.log('Unknown endpoint:', event.path);\n      return {\n        statusCode: 404,\n        headers,\n        body: JSON.stringify({\n          error: 'Endpoint not found',\n          message: `Unknown endpoint: ${event.path}`,\n          availableEndpoints: ['/styles', '/generate', '/status/:id', '/test']\n        })\n      };\n    }\n  } catch (error) {\n    console.error('Skybox function error:', error);\n    console.error('Error stack:', error.stack);\n    \n    return {\n      statusCode: 500,\n      headers,\n      body: JSON.stringify({\n        error: 'Internal server error',\n        message: error.message,\n        details: process.env.NODE_ENV === 'development' ? error.stack : undefined\n      })\n    };\n  }\n};\n\n// Handle getting skybox styles\nasync function handleGetStyles(headers, sdk) {\n  try {\n    console.log('Fetching skybox styles from BlockadeLabs API using SDK');\n    \n    const styles = await sdk.getSkyboxStyles();\n    console.log('Successfully fetched skybox styles:', styles);\n\n    // Format response to match backend API structure\n    const formattedResponse = {\n      success: true,\n      data: {\n        styles: styles\n      },\n      message: `Retrieved ${styles.length} skybox styles`,\n      pagination: {\n        page: 1,\n        limit: styles.length,\n        total: styles.length,\n        totalPages: 1,\n        hasNext: false,\n        hasPrev: false\n      }\n    };\n\n    return {\n      statusCode: 200,\n      headers: {\n        ...headers,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(formattedResponse)\n    };\n  } catch (error) {\n    console.error('Error fetching styles:', error);\n    throw error;\n  }\n}\n\n// Handle skybox generation\nasync function handleGenerate(headers, sdk, event) {\n  try {\n    console.log('Generating skybox with BlockadeLabs API');\n    \n    const requestBody = JSON.parse(event.body || '{}');\n    console.log('Generation request body:', requestBody);\n\n    const generation = await sdk.generateSkybox({\n      prompt: requestBody.prompt,\n      skybox_style_id: requestBody.skybox_style_id,\n      webhook_url: requestBody.webhook_url\n    });\n\n    console.log('Generation started:', generation);\n\n    return {\n      statusCode: 200,\n      headers: {\n        ...headers,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        success: true,\n        data: generation,\n        message: 'Skybox generation started successfully'\n      })\n    };\n  } catch (error) {\n    console.error('Error generating skybox:', error);\n    throw error;\n  }\n}\n\n// Handle getting generation status\nasync function handleGetStatus(headers, sdk, event) {\n  try {\n    console.log('Getting generation status');\n    \n    // Extract generation ID from path\n    const pathParts = event.path.split('/');\n    const generationId = pathParts[pathParts.length - 1];\n    \n    if (!generationId) {\n      return {\n        statusCode: 400,\n        headers,\n        body: JSON.stringify({\n          error: 'Generation ID is required',\n          message: 'Please provide a valid generation ID in the URL'\n        })\n      };\n    }\n\n    const status = await sdk.getSkyboxGeneration(generationId);\n    console.log('Generation status:', status);\n\n    return {\n      statusCode: 200,\n      headers: {\n        ...headers,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        success: true,\n        data: status,\n        message: 'Generation status retrieved successfully'\n      })\n    };\n  } catch (error) {\n    console.error('Error getting generation status:', error);\n    throw error;\n  }\n} "],
  "mappings": "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",
  "names": []
}
